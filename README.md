# @monolithed/portal-template

Пример шаблона портального архетипа

## Установка

```
git clone git@github.com:monolithed/portal-template.git
```

## Запуск

### Платформа 

1. Перейдите в директорию `platform`
2. Выполните `npm install`
3. Запустите `npm start`
4. Откройте в браузере `http://localhost:3001`

### Стрим 

1. Перейдите в директорию `stream`
2. Повторите шаги выше
3. Откройте в браузере `http://localhost:3006`

У вас будет запущено 2 процесса: на порту 3001 будет корневое приложение (портал), а на 3006 стрим (приложение, которое подгрузится в портал).

### Механика работы 

1. Вебпак собирает 2 независимых приложения по схеме [Module Federation](https://webpack.js.org/concepts/module-federation/). 
2. Сценарий подгрузки подробно описан в [Module Federation Loader](https://github.com/monolithed/module-federation-loader)
3. Все бандлы, которые загружатся доступны по прямому обращению через глобальное простанство имен. 
Имя банала задается в конфиге вебпака стрима: `new ModuleFederationPlugin({name: '__tutorial_stream__'})`. Так мы создаем глобальную переменную `window.__tutorial_stream__`, которую впоследствии используем для обращения к компонентам бандла.
Чтобы избежать конфликта имен старайтесь давать названиям ваших бандлов уникальные префиксы.

## Как пользоваться

1. Разнесите platform и stream на два независимых репозитория (сримов может быть неограниченное количество).
2. Соберите platform и разложите на стенд
3. Соберите стримы
4. Сборки со стримами положите на CDN, а пути к ним хеши положите в базу данных, чтобы в последствии их можно было запросить у сервера.
5. Создайте эндпоинт, который будет возвращать по названию бандла его src и integrity (опционально).  
6. При каждом обращении к внешнему компоненту будет делаться запрос за сборкой
7. Чтобы использовать стратегию кеширования и откатов имена сборок должны быть с хешами.
8. В директории `api/workspace/bundle.json` лежат заглушки для тестового примера.  

## Лицензия

MIT
